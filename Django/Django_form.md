### ## TIL: Django CRUD와 HTTP 요청/응답

#### **학습 목표**

* View 함수에서 QuerySet API를 활용하여 데이터를 조회, 생성, 수정, 삭제하는 전 과정을 구현할 수 있음.
* HTTP request methods (GET, POST) 개념과 각각의 특징 및 적절한 사용법을 설명할 수 있음.
* 클라이언트 요청에 대한 서버의 처리 결과를 나타내는 HTTP response status code 의미를 이해함.
* CSRF (Cross-Site Request Forgery) 공격의 개념을 이해하고, Django에서 CSRF 토큰을 적용하는 방법을 학습함.
* POST 요청 처리 후 중복 데이터 생성과 같은 문제점을 인지하고, `redirect()` 함수를 활용한 적절한 응답 처리 방식을 구현할 수 있음.
* 캐시(Cache)의 개념과 장점을 이해하고, GET과 POST 메서드의 차이점을 명확히 비교할 수 있음.

---

#### **1. GET vs POST: 요청 방식**

웹에서 데이터를 주고받는 방식(HTTP Method) 중 가장 중요한 두 가지는 GET과 POST임.

* **GET ➡️ "데이터 조회" (Read)**
    * 서버의 데이터를 변경하지 않고, 단순히 **읽거나 조회**할 때 사용함.
    * 데이터가 URL에 노출되며 **캐싱(Caching)**이 가능함.
    * **사용 예시**: 게시글 목록 보기, 게시글 상세 보기.

* **POST ➡️ "데이터 변경" (Create/Update/Delete)**
    * 서버의 데이터를 **생성, 수정, 삭제**할 때 사용함.
    * 데이터를 요청 본문(body)에 담아 전송하므로 URL에 노출되지 않음.
    * **사용 예시**: 게시글 작성, 회원가입, 로그인, 글 삭제.

> **핵심 원칙**: **데이터베이스(DB)를 변경하는 작업은 POST를 사용함.**

---

#### **2. CSRF 토큰: 요청 위조 방지**

* **CSRF(사이트 간 요청 위조)란?**: 사용자의 의지와 무관하게, 해커가 의도한 행동(글쓰기 등)을 해당 사용자의 계정으로 서버에 요청하게 만드는 해킹 방식임.

* **Django의 방어법: `{% csrf_token %}`**
    * Django는 이 공격을 방어하기 위해 `POST` 방식의 `<form>` 안에 **`{% csrf_token %}`** 삽입을 강제함.
    * 이 토큰은 "실제 사용자가 보낸 유효한 요청"임을 증명하는 **일회용 비밀 표식**과 같음.
    * 서버는 `POST` 요청을 받으면 이 표식이 유효한지 검사하며, 위조된 사이트에서 온 요청은 토큰이 없으므로 차단됨.

---

#### **3. Redirect: 데이터 중복 제출 방지**

* **문제 상황**: `POST` 요청으로 글을 작성한 직후 완료 페이지에서 "새로고침"을 누르면, 브라우저는 이전에 보냈던 `POST` 요청을 다시 보내려고 시도함. 이로 인해 동일한 글이 중복 등록될 수 있음.

* **해결책: Post-Redirect-Get 패턴**
    1.  **[POST]**: 사용자가 폼을 제출하면, view 함수는 데이터를 DB에 저장함.
    2.  **[Redirect]**: view 함수는 작업 완료 페이지를 직접 보여주는 대신, 다른 URL로 다시 접속하라는 `redirect` 명령을 브라우저에 응답함.
    3.  **[GET]**: 브라우저는 `redirect` 명령에 따라 새로운 URL로 **`GET`** 요청을 다시 보냄.
    4.  서버는 이 `GET` 요청에 대한 페이지를 최종적으로 보여줌.

* **결과**: 사용자의 브라우저에 남은 마지막 기록은 안전한 `GET` 요청이므로, 새로고침해도 데이터가 중복으로 쌓이지 않음.

> **핵심 원칙**: `GET` 요청 뷰는 `render()`로, 성공적으로 처리된 `POST` 요청 뷰는 `redirect()`로 응답하는 것이 일반적임.
